<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="/chart.js"></script>
    <script src="/Chart.bundle.min.js"></script>
    <link rel="stylesheet" href="/Chart.min.css">
    <link rel="stylesheet" href="/Chart.css">
    <title>Chart</title>
</head>
<body>
    <!-- <button onclick="changeChartToNewConfirmedCases()">New Confirmed Cases</button>
    <button onclick="changeChartToNewDeathCases()">New Death Cases</button>
    <button onclick="changeChartToNewRecoveredCases()">New Recovered Cases</button> -->
    <button onclick="changeChartToTotalConfirmedCases()">Total Confirmed Cases</button>
    <button onclick="changeChartToTotalConfirmedCases()">Sum Confirmed Cases</button>
    <button onclick="changeChartToTotalDeathCases()">Total Death Cases</button>
    <button onclick="changeChartToTotalRecoveredCases()">Total Recovered Cases</button>
    <canvas id="myChart" width="1000" height="400"></canvas>

  <script>
    const random_rgba = () => {
    var o = Math.round, r = Math.random, s = 255;
    return 'rgba(' + o(r()*s) + ',' + o(r()*s) + ',' + o(r()*s) + ',' + r().toFixed(1) + ')';
}

    const color = random_rgba();
    const reducer = (accumulator, currentValue) => accumulator + currentValue;
    const state = {
      // NewConfirmed: [],
      // NewDeaths: [],
      // NewRecovered: [],
      TotalConfirmed: [],
      SumConfirmed: [],
      TotalDeaths: [],
      SumDeaths: [],
      TotalRecovered: [],
      SumRecodered: [],
    };

    const formatDate = (date) => {
      let d = new Date(date),
        month = '' + (d.getMonth() + 1),
        day = '' + d.getDate(),
        year = d.getFullYear();

      if (month.length < 2) 
        month = '0' + month;
      if (day.length < 2) 
        day = '0' + day;

      return [year, month, day].join('-');
    };

    // API returns data only for 250 days
    const dateArr = [];
    const getArrOfDates = () => {
      for(let i = 250; i > 1; i--) {
        const today = new Date();
        dateArr.push(formatDate(today.setDate( today.getDate() - i )));
      }
    };

    getArrOfDates();


    const getData = async() => {
      const url = `https://api.covid19api.com/world?from=${dateArr[0]}&to=${dateArr[dateArr.length - 1]}`
      const response = await fetch(url);
      const data = await response.json();

      updateState(data);
    };

    getData();
    
    const updateState = (data) => {
      data.map((item) => {
        // state.NewConfirmed.push(item.NewConfirmed);
        // state.NewDeaths.push(item.NewDeaths);
        // state.NewRecovered.push(item.NewRecovered); 
        state.TotalConfirmed.push(item.TotalConfirmed);
        state.SumConfirmed.push(item.TotalConfirmed.reducer);
        state.TotalDeaths.push(item.TotalDeaths);
        state.TotalRecovered.push(item.TotalRecovered);
      });
    };


    const ctx = document.getElementById('myChart').getContext('2d');
    const myChart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: dateArr,
        datasets: [{
         label: 'New Confirmed Cases',
         data: state.NewConfirmed,
         backgroundColor: [color],
         borderColor: [color],
         borderWidth: 1
       }],
      },
    });

    // const changeChartToNewConfirmedCases = () => {
    //   myChart.data.datasets[0].label = 'New Confirmed Cases';
    //   myChart.data.datasets[0].data = state.NewConfirmed;
    //   myChart.update();
    // };

    // const changeChartToNewDeathCases = () => {
    //   myChart.data.datasets[0].label = 'New Death Cases';
    //   myChart.data.datasets[0].data = state.NewDeaths;
    //   myChart.update();
    // };

    // const changeChartToNewRecoveredCases = () => {
    //   myChart.data.datasets[0].label = 'New Recovered Cases';
    //   myChart.data.datasets[0].data = state.NewRecovered;
    //   myChart.update();
    // };

    const changeChartToTotalConfirmedCases = () => {
      myChart.data.datasets[0].label = 'Total Confirmed Cases';
      myChart.data.datasets[0].data = state.TotalConfirmed;
      myChart.data.datasets[0].color = [color];
      myChart.update();
    };

    const changeChartToTotalDeathCases = () => {
      myChart.data.datasets[0].label = 'Total Death Cases';
      myChart.data.datasets[0].data = state.TotalDeaths;
      myChart.update();
    };

    const changeChartToTotalRecoveredCases = () => {
      myChart.data.datasets[0].label = 'Total Recovered Cases';
      myChart.data.datasets[0].data = state.TotalRecovered;
      myChart.update();
    };
    
  </script>
</body>
</html>
